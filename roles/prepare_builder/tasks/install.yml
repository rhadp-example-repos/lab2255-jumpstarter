# Implement your install deployment tasks here
# -------------------------------------------------
- name: running install tasks
  debug:
    msg: "Running installation tasks for {{ role_name }}"

- name: Remove the builder directory
  become: true
  ansible.builtin.file:
    path: "{{ work_dir }}/{{ build_dir }}"
    state: absent
  when: remove_builder_dir

- name: Create builder sub-directories
  become: true
  ansible.builtin.file:
    path: "{{ work_dir }}/{{ build_dir }}/{{ item }}"
    state: directory
  with_items:
    - "manifests"
    - "builds"
    - ".mpp-cache"
  when: remove_builder_dir

- name: Clone the repo
  become: true
  ansible.builtin.git:
    repo: "{{ aib_repo }}"
    version: "{{ aib_branch }}"
    dest: "{{ work_dir }}/{{ build_dir }}/{{ aib_dest }}"
    single_branch: yes
  when: remove_builder_dir

- name: Copy builder.sh
  become: true
  ansible.builtin.copy:
    src: "../templates/build.sh"
    dest: "{{ work_dir }}/{{ build_dir }}/build.sh"
    mode: "0755"
  when: remove_builder_dir

- name: Copy the build manifest examples
  become: true
  ansible.builtin.template:
    src: "../templates/{{ item }}"
    dest: "{{ work_dir }}/{{ build_dir }}/manifests/{{ item }}"
    mode: "0644"
  loop:
    - "basic.mpp.yml"

# Leave these as the last tasks in the playbook
- name: install tasks complete
  debug:
    msg: "Install tasks completed successfully."
  when:
    - not silent|bool
